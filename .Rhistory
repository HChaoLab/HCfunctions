# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] = gray #R
orange[:, :, 1] = 0.65 * gray  # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
orange_img = gray_to_cyan_rgb(stack[channel_Eca_green])
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
orange_img
orange_img
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] = gray #R
# orange[:, :, 1] = 0.65 * gray  # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] = gray #R
# orange[:, :, 1] = 0.65 * gray  # G
orange[:, :, 2] = 0
orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] = gray #R
orange[:, :, 1] = 0.65 * gray  # G
orange[:, :, 2] = 0
orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
# orange[:, :, 0] = gray #R
orange[:, :, 1] = 0.65 * gray  # G
orange[:, :, 2] = 0
orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
# orange[:, :, 0] = gray #R
orange[:, :, 1] = gray  # G
orange[:, :, 2] = 0
orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
# orange[:, :, 0] = gray #R
orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
orange_img
orange_img.max()
normalize_channel
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] = gray #R
# orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
orange_img.max
orange_img.max()
orange_img.min()
orange_img.shape
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.uint8)
orange[:, :, 0] =  normalize_channel(gray) #R
# orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.float32)
orange[:, :, 0] =  normalize_channel(gray) #R
# orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.float32)
orange[:, :, 0] =  gray #R
# orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
# ensure uint8
# gray_u8 = gray.astype(np.uint8)
# gray = normalize_channel(gray)
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.float32)
orange[:, :, 0] =  gray #R
orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0
# orange = normalize_channel(orange)
# orange = np.zeros((H, W, 3), dtype=np.uint8)
# orange[:, :, 0] = gray                # R
# orange[:, :, 1] = (0.65 * gray).astype(np.uint8)  # G
# orange[:, :, 2] = 0                      # B
return orange
orange_img = gray_to_orange_rgb(stack[channel_Eca_green])
orange_img
plt.figure(figsize=(8,8))
plt.imshow(orange_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
def gray_to_orange_rgb(gray):
"""
Convert a grayscale image (0–255) to an orange RGB image.
Orange ≈ (R=gray, G=0.65*gray, B=0)
Parameters
----------
gray : np.ndarray
2D grayscale array (H x W), dtype uint8 or float.
Returns
-------
rgb : np.ndarray
RGB image array (H x W x 3), dtype uint8.
"""
orange = np.zeros((gray.shape[0], gray.shape[1], 3), dtype=np.float32) # np.float32 很重要
orange[:, :, 0] =  gray #R
orange[:, :, 1] = gray *0.6 # G
orange[:, :, 2] = 0 # B
return orange
rgb_img = np.zeros((height, width, 3), dtype=np.float32)
rgb_img[:, :, 0] = normalize_channel(np.minimum(stack[channel_CD45_red], stack[channel_CD68_red]))
rgb_img[:, :, 1] = normalize_channel(np.maximum(stack[channel_Eca_green], stack[channel_bCat_green])+stack[channel_CK7_green])
rgb_img[:, :, 2] = normalize_channel(np.maximum(stack[channel_DNA1_blue], stack[channel_DNA2_blue]))
cyan_img = gray_to_cyan_rgb(np.minimum(stack[channel_SMA_cyan], stack[channel_Collagen_cyan]))
cyan_img = gray_to_cyan_rgb(stack[channel_Eca_green])
orange_img = gray_to_orange_rgb(stack[channel_CD34_orange])
rgb_img = mixRgb(rgb_img,orange_img)
plt.figure(figsize=(8,8))
plt.imshow(rgb_img)
plt.axis('off')
plt.title("Merged RGB (R=Ch01, G=Ch21, B=Ch41)")
plt.show()
output_folder = "D:/Download/HCC_DiscoveryCohort/CD34_CD68_CD45_HSC/"
# 创建输出文件夹
os.makedirs(output_folder, exist_ok=True)
# 遍历文件夹所有 TIFF
for filename in os.listdir(input_folder):
# if filename.lower().endswith(".tiff") and "tumor" in filename.lower():
file_path = os.path.join(input_folder, filename)
print("Processing:", filename)
# 读取堆叠图
stack = tifffile.imread(file_path)
# if stack.ndim != 3:
#     print(f"Warning: {filename} shape {stack.shape} not 3D, skipped.")
#     continue
n_channels, height, width = stack.shape
# 创建 RGB 图像
rgb_img = np.zeros((height, width, 3), dtype=np.float32)
rgb_img[:, :, 0] = normalize_channel(np.minimum(stack[channel_CD45_red], stack[channel_CD68_red]))
rgb_img[:, :, 1] = normalize_channel(np.maximum(stack[channel_Eca_green], stack[channel_bCat_green])+stack[channel_CK7_green])
rgb_img[:, :, 2] = normalize_channel(np.maximum(stack[channel_DNA1_blue], stack[channel_DNA2_blue]))
cyan_img = gray_to_cyan_rgb(np.minimum(stack[channel_SMA_cyan], stack[channel_Collagen_cyan]))
cyan_img = gray_to_cyan_rgb(stack[channel_Eca_green])
orange_img = gray_to_orange_rgb(stack[channel_CD34_orange])
rgb_img = mixRgb(rgb_img,cyan_img)
rgb_img = mixRgb(rgb_img,orange_img)
# 保存为 PNG
out_name = os.path.splitext(filename)[0] + "Mac_RGB.png"
out_path = os.path.join(output_folder, out_name)
plt.imsave(out_path, rgb_img)
print("Saved:", out_path)
print("All tumor TIFFs processed!")
devtools::document()
devtools::document()
devtools::document()
library(TCGAbiolinks)
# 1. 查询 clinical / supplement 的 BCR Biotab 临床信息
query <- GDCquery(
project = "TCGA-LIHC",                # HCC (肝癌) 项目
data.category = "Clinical",
data.type = "Clinical Supplement",
data.format = "BCR Biotab"
)
GDCdownload(query)
clinical <- GDCprepare(query)
head(clinical)
clinical$clinical_nte_lihc
library(stringr)
sapply(clinical, function(x)str_detect(colnames(x),'vascular'))
colnames(clinical)
names(clinical)
sapply(clinical, function(x)colnames(x))
sapply(clinical, function(x)colnames(x)[str_detect(colnames(x),'vascular')])
clinical$clinical_patient_lihc$vascular_invasion
table(clinical$clinical_patient_lihc$vascular_invasion)
setwd('F:\\SynologyDrive\\Huang_Chao\\Research Projects\\HCC_cell fusion')
save(Clinical,file = 'clinical_LIHC.RData')
save(clinical,file = 'clinical_LIHC.RData')
